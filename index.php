<?php
$personal_feed = [
    [
        'title' => "David Walliams: once the nation's favourite — now fighting to return",
        'excerpt' => "David Walliams has faced a turbulent few years since leaving BGT and is now focused on books and podcasts.",
        'comments' => 615,
        'shares' => 48,
        'image' => 'assets/tv_assets/article9-img1.png',
        'link' => 'articles/TV/tv_article9.php'
    ],
    [
        'title' => "Melania Trump slammed over 'really bizarre' faux pas while reading Christmas story to kids during hospital visit",
        'excerpt' => "Melania was criticised after reading to children without showing them the pictures.",
        'comments' => 214,
        'shares' => 12,
        'image' => 'assets/HomePage_assets/Homepage_article3-image1.png',
        'link' => 'articles/HomePage/Home_mainfeed-article3.php'
    ],
    [
        'title' => "Trump's Treasury chief's shock admission about the economy ... and why it might be worth it",
        'excerpt' => "Treasury Secretary Scott Bessent warns of a 'detox period' as spending cuts bite, but says private investment will fill the gap.",
        'comments' => 117,
        'shares' => 18,
        'image' => 'assets/US_assets/article3-img1.png',
        'link' => 'articles/US/US-article3.php',
        'category' => 'US',
        'tags' => ['Economy','Politics']
    ],
    [
        'title' => 'World Cup play-off draw: Wales and Northern Ireland',
        'excerpt' => "Wales and Northern Ireland in collision course for place in tournament.",
        'comments' => 1,
        'shares' => 0,
        'image' => 'assets/news_article_pics/news1coffeeimg1.png'
    ],
    [
        'title' => 'Media laws to stay despite US tech giant threat',
        'lead' => 'US pressure fails to shift Australia\'s position on media laws.',
        'image' => 'assets/US_assets/article2-img1.png',
        'link' => 'articles/US/US_article2.php',
        'category' => 'US',
        'comments' => 61,
        'shares' => 0,
        'tags' => ['Law','Tech']
    ]
];

$main_feed = [
    [
        'title' => "Trump explodes at Zelensky for not accepting peace deal as he warns Putin 'has the upper hand'",
        'excerpt' => "The President criticised Zelensky and warned Russia holds the upper hand in negotiations.",
        'comments' => 842,
        'shares' => 98,
        'image' => 'assets/HomePage_assets/Homepage_article2-image1.png',
        'category' => 'Latest headlines',
        'link' => 'articles/HomePage/Home_mainfeed-article2.php'
    ],
    [
        'title' => "Shona McGarty shares heartbreaking confession about her mental health before I'm A Celebrity",
        'excerpt' => "Shona McGarty says a pre-jungle digital detox helped her overcome doomscrolling and reconnect with family.",
        'comments' => 15,
        'shares' => 3,
        'image' => 'assets/tv_assets/article5-img1.png',
        'category' => 'Latest headlines',
        'link' => 'articles/TV/tv_article5.php'
    ],
    [
        'title' => "Worker is fired from her job after boss was fed up with her arriving 40 minutes EARLY all the time",
        'excerpt' => "A Spanish office worker was dismissed after repeatedly arriving 40 minutes before her shift and ignoring company rules.",
        'comments' => 12,
        'shares' => 3,
        'image' => 'assets/HomePage_assets/Homepage_article1-image1.png',
        'category' => 'Latest headlines',
        'link' => 'articles/HomePage/Home_mainfeed-article1.php'
    ],
    [
        'title' => "Binky Felstead reveals what she eats in a day and how she trains to maintain her strong gym-honed figure while juggling parenting three children",
        'excerpt' => "Binky Felstead explains her workouts and meals while juggling three children — practical tips and allergy-management updates.",
        'comments' => 105,
        'shares' => 20,
        'image' => 'assets/tv_assets/article6-img1.png',
        'category' => 'Latest headlines',
        'link' => 'articles/TV/tv_article6.php'
    ],
    [
        'title' => "Revealed: Which World Cup games the BBC and ITV will show next summer as broadcasters CONFIRM match split",
        'comments' => 214,
        'shares' => 12,
        'image' => 'assets/news_article_pics/News-18.avif',
        'category' => 'Latest headlines',
        'link' => 'articles/News/News_catfeed-article1.php'
    ],
    [
        'title' => "The item that sells every minute globally transforms under-eye bags in SECONDS: 'You look 10 years younger'",
        'excerpt' => "An Australian beauty product that mimics the appearance of having had under-eye surgery has become a global bestseller, with one bottle purchased every minute.",
        'comments' => 214,
        'shares' => 12,
        'image' => 'assets/news_article_pics/News-1.avif',
        'category' => 'Australia',
        'link' => 'articles/News/News_mainfeed-article1.php'
    ],
    [
        'title' => "QUENTIN LETTS: Brother Torsten shimmered, beamed and lovingly stroked his girlishly smooth throat...",
        'comments' => 214,
        'shares' => 12,
        'image' => 'assets/news_article_pics/News-15.avif',
        'category' => 'Latest headlines',
        'link' => 'articles/News/News_mainfeed-article4.php'
    ],
    [
        'title' => "Michelle Obama blasts 'aging' leaders who 'hold on for too long' in veiled swipe at Joe Biden",
        'comments' => 214,
        'shares' => 12,
        'image' => 'assets/news_article_pics/News-24.avif',
        'category' => 'Latest headlines',
        'link' => 'articles/News/News_catfeed-article3.php'
    ],
];

$category_strip = [
    [
        'title' => "Taylor Swift embraces her glamorous era in a $1.7k velvet minidress for sit-down interview with Stephen Colbert",
        'comments' => 35,
        'shares' => 5,
        'image' => 'assets/US_assets/article1-img1.png',
        'category' => 'Showbiz',
        'link' => 'articles/US/US_article1.php'
    ],
    [
        'title' => 'Neighbours finale episode set to hit screens today - after the soap was AXED for the second time less than two years after its revival',
        'comments' => 15,
        'shares' => 4,
        'image' => 'assets/tv_assets/article7-img1.png',
        'category' => 'Showbiz',
        'link' => 'articles/TV/tv_article7.php'
    ],
    [
        'title' => "The 19 signs that say you're insecure: Psychotherapist reveals the tell-tale quirks - including how you carry your handbag",
        'comments' => 34,
        'shares' => 5,
        'image' => 'assets/HomePage_assets/Homepage_article4-image1.png',
        'category' => 'Health',
        'link' => 'articles/HomePage/Home_mainfeed-article4.php'
    ],
    [
        'title' => "Maven, we have a problem: NASA has lost contact with a spacecraft that has been orbiting Mars for more than a DECADE",
        'excerpt' => "NASA has lost contact with the MAVEN orbiter — a setback that could halt a decade of Martian atmospheric research.",
        'comments' => 35,
        'shares' => 35,
        'image' => 'assets/HomePage_assets/Homepage_article5-image1.png',
        'category' => 'Science',
        'link' => 'articles/HomePage/Home_mainfeed-article5.php'
    ],
    [
        'title' => 'We still owe £300,000, can an offset mortgage save us money?',
        'excerpt' => 'Reader asks whether switching to an offset mortgage would reduce payments on a £300,000 balance.',
        'comments' => 19,
        'shares' => 2,
        'image' => 'assets/US_assets/article6-img1.png',
        'category' => 'Money',
        'link' => 'articles/US/US-article6.php'
    ],
    [
        'title' => "Simon Cowell: The Next Act savaged as 'dated, derivative and as flat as his hairdo'",
        'comments' => 64,
        'shares' => 8,
        'image' => 'assets/tv_assets/article2-img1.png',
        'category' => 'Showbiz',
        'link' => 'articles/TV/tv_article2.php'
    ],
    [
        'title' => "London s 25 best martinis revealed: After five years of research (and hundreds of drinks!), HUGHIE DE ZULUETA and ELLA MAY share their must-read guide",
        'comments' => 112,
        'shares' => 18,
        'image' => 'assets/Buyline_assets/Travel_SPic-5.avif',
        'category' => 'Lifestyle',
        'link' => 'articles/buyline/Travel_article-1.php'
    ],
    [
        'title' => "The best suitcase deals on travel-editor approved brands - including Amazon and John Lewis offers of up to 40% off",
        'comments' => 56,
        'shares' => 6,
        'image' => 'assets/Buyline_assets/Travel_SPic-6.avif',
        'category' => 'Travel',
        'link' => 'articles/buyline/Travel_article-2.php'
    ],
];

// Extra articles collected from other section pages (news, royals, us, tv, buyline, mplus)
$extra_feed = [
    // News
    [ 'title' => "Art swindler shares jaw-dropping explanation of how his wife 'died' and why he chopped up her body", 'excerpt' => "In opening statements...", 'comments' => 214, 'shares' => 12, 'image' => 'assets/news_article_pics/News-5.avif', 'category' => 'The Crime Desk', 'link' => 'articles/News/News_mainfeed-article2.php' ],
    // Royals
    [ 'title' => 'How ex-PM John Major played the role of an honest broker between Charles and Diana during the War of the Waleses', 'excerpt' => 'An inside look at John Major\'s mediating role within the royal family.', 'comments' => 220, 'shares' => 34, 'image' => 'assets/Royal_assets/Royal-1.avif', 'category' => 'King Charles III', 'link' => 'articles/Royals/Royal_mainfeed-article1.php' ],
    [ 'title' => 'Prince William celebrates 20 years of his patronage with homeless charity Centrepoint', 'excerpt' => 'William marks two decades supporting Centrepoint in a heartfelt visit.', 'comments' => 160, 'shares' => 19, 'image' => 'assets/Royal_assets/Royal-5.avif', 'category' => 'Prince William', 'link' => 'articles/Royals/Royal_mainfeed-article2.php' ],
    [ 'title' => 'Lady Davina Windsor and her daughter Senna support Kate Middleton at Christmas carol concert', 'excerpt' => 'Davina and her daughter Senna attend a festive outing with Kate.', 'comments' => 98, 'shares' => 12, 'image' => 'assets/Royal_assets/Royal-8.avif', 'category' => 'Kate Middleton', 'link' => 'articles/Royals/Royal_mainfeed-article3.php' ],
    [ 'title' => 'Prince Harry believes Home Office review into his taxpayer-funded security is long overdue', 'excerpt' => 'Sources say the review into taxpayer-funded security is proceeding.', 'comments' => 305, 'shares' => 48, 'image' => 'assets/Royal_assets/Royal-12.avif', 'category' => 'Prince Harry', 'link' => 'articles/Royals/Royal_mainfeed-article4.php' ],
    [ 'title' => 'Meghan Markle sends letter to her sick father Thomas in hospital', 'excerpt' => 'Meghan reached out to her father amid concerns about his health.', 'comments' => 142, 'shares' => 21, 'image' => 'assets/Royal_assets/Royal-15.avif', 'category' => 'Meghan Markle', 'link' => 'articles/Royals/Royal_mainfeed-article5.php' ],
    // US
    [ 'title' => "Taylor Swift embraces her glamorous era in a $1.7k velvet minidress for sit-down interview with Stephen Colbert", 'excerpt' => "Taylor Swift made a glamorous appearance on Wednesday's Late Show with Stephen Colbert.", 'comments' => 35, 'shares' => 5, 'image' => 'assets/US_assets/article1-img1.png', 'category' => 'Entertainment', 'link' => 'articles/US/US_article1.php' ],
    [ 'title' => "Trump's Treasury chief's shock admission about the economy ... and why it might be worth it", 'excerpt' => "Treasury Secretary Scott Bessent warns of a 'detox period' as spending cuts bite, but expects private sector to step up.", 'comments' => 117, 'shares' => 18, 'image' => 'assets/US_assets/article3-img1.png', 'category' => 'Economy', 'link' => 'articles/US/US-article3.php' ],
    [ 'title' => 'Show shines light on Mormons\' unique place in US culture', 'excerpt' => 'How a reality show has brought Mormon culture into mainstream conversation.', 'comments' => 5, 'shares' => 1, 'image' => 'assets/US_assets/article5-img1.png', 'category' => 'Entertainment', 'link' => 'articles/US/US-article5.php' ],
    [ 'title' => "Walmart CEO gives update on prices as retail bellwether announces surge in sales", 'excerpt' => 'Walmart reports strong like-for-like sales and discusses pricing pressures.', 'comments' => 17, 'shares' => 6, 'image' => 'assets/US_assets/article4-img1.png', 'category' => 'Economy', 'link' => 'articles/US/US-article4.php' ],
    [ 'title' => 'US business groups voice dismay at Trump\'s new tariffs', 'excerpt' => 'Business groups condemn sweeping tariffs and warn of cost impacts.', 'comments' => 12, 'shares' => 3, 'image' => 'assets/US_assets/article7-img1.png', 'category' => 'Business', 'link' => 'articles/US/US-article7.php' ],
    // TV
    [ 'title' => 'Neighbours finale episode set to hit screens today - after the soap was AXED for the second time', 'excerpt' => 'Neighbours will air its final episode on Thursday after being axed for a second time.', 'comments' => 15, 'shares' => 4, 'image' => 'assets/tv_assets/article7-img1.png', 'category' => 'Soaps', 'link' => 'articles/TV/tv_article7.php' ],
    [ 'title' => 'Inside Netflix\'s buzzy new drama: what to expect from the gripping first season', 'excerpt' => 'Our guide to the cast, what happens and why everyone is talking about it.', 'comments' => 15, 'shares' => 10, 'image' => 'assets/tv_assets/article4-img1.png', 'category' => 'Netflix', 'link' => 'articles/TV/tv_article4.php' ],
    [ 'title' => "Simon Cowell: The Next Act savaged as 'dated, derivative and as flat as his hairdo'", 'excerpt' => "Critics accuse the music mogul of 'rehashing The X Factor for the billionth time' with a new Netflix documentary.", 'comments' => 64, 'shares' => 8, 'image' => 'assets/tv_assets/article2-img1.png', 'category' => 'Showbiz', 'link' => 'articles/TV/tv_article2.php' ],
    [ 'title' => "We've found Keira Knightley's exact outfits from the Waitrose Christmas advert at John Lewis - and they make for the perfect winter wardrobe", 'excerpt' => "Everything you need to recreate Keira Knightley's cosy-chic looks from the Waitrose Christmas advert.", 'comments' => 5, 'shares' => 1, 'image' => 'assets/tv_assets/article3-img1.png', 'category' => "I'm a Celebrity", 'link' => 'articles/TV/tv_article3.php' ],
    // Buyline (beauty / fashion / travel / royals / personal)
    [ 'title' => 'The miracle in a bottle cream that celebs swear by to target wrinkles and dryness', 'excerpt' => 'A cult cream loved by celebs for smoothing and hydration.', 'comments' => 547, 'shares' => 30, 'image' => 'assets/Buyline_assets/MainFeed_Artc_1 pic.avif', 'category' => 'Beauty', 'link' => 'articles/buyline/Beautyfeed_article-1.php' ],
    [ 'title' => 'Panic buying presents? No need. The 10 best budget beauty stocking fillers', 'excerpt' => 'Affordable stocking fillers editors are gifting this year.', 'comments' => 214, 'shares' => 8, 'image' => 'assets/Buyline_assets/MainFeed_Artc_2 pic.avif', 'category' => 'Beauty', 'link' => 'articles/buyline/Beautyfeed_article-2.php' ],
    [ 'title' => 'Men are ditching expensive fragrances for £31 scent that turns heads', 'excerpt' => 'A pocket-friendly fragrance that\'s become a favourite.', 'comments' => 632, 'shares' => 29, 'image' => 'assets/Buyline_assets/MainFeed_Artc_3 pic.avif', 'category' => 'Lifestyle', 'link' => 'articles/buyline/Beautyfeed_article-3.php' ],
    [ 'title' => "Cat Deeley just wore this fashionably festive jumper on This Morning - here's where you can buy it", 'excerpt' => "Cat Deeley's festive jumper and three alternatives you can buy now.", 'comments' => 23, 'shares' => 1, 'image' => 'assets/Buyline_assets/PerFeed_Artc_1 pic.avif', 'category' => 'Fashion', 'link' => 'articles/buyline/Fashionfeed_article-1.php' ],
    [ 'title' => 'The Haier air fryer that cuts cooking times in half has finally gone on sale', 'excerpt' => 'A top-selling air fryer now at its lowest-ever price.', 'comments' => 84, 'shares' => 12, 'image' => 'assets/Buyline_assets/HomeGarden_1.avif', 'category' => 'Home & Garden', 'link' => 'articles/buyline/HomeGardenfeed_article-1.php' ],
    [ 'title' => 'London s 25 best martinis revealed: The definitive guide', 'excerpt' => "The definitive guide to London's best martinis after extensive research.", 'comments' => 112, 'shares' => 18, 'image' => 'assets/Buyline_assets/Travel_SPic-5.avif', 'category' => 'Travel', 'link' => 'articles/buyline/Travel_article-1.php' ],
    [ 'title' => 'Kate Middleton makes star drop earrings the must-have accessory of the season', 'excerpt' => 'Shop Kate Middleton\'s star drop earrings and similar picks.', 'comments' => 402, 'shares' => 22, 'image' => 'assets/Buyline_assets/Royal_Pic-1.avif', 'category' => 'Royals', 'link' => 'articles/buyline/Royale_article-1.php' ],
    // mplus entries (no dedicated article pages; link back to mplus)
    [ 'title' => "Exclusive: Inside m+ — The City's Most Secret Skin Treatments", 'excerpt' => "We tried the treatments top insiders swear by — here's what actually works.", 'comments' => 12, 'shares' => 3, 'image' => 'assets/news_article_pics/News-4.avif', 'category' => 'Exclusive', 'link' => 'mplus.php#exclusive' ],
    [ 'title' => "Trending on m+: A-List Fitness Routines You Can Do At Home", 'excerpt' => 'Short, intense workouts recommended by celebs — no equipment needed.', 'comments' => 4, 'shares' => 1, 'image' => 'assets/MPlus_assets/mplus-assets-img1.png', 'category' => 'Trending', 'link' => 'mplus.php#trending' ],
];

// Automatically collect any article (except podcasts) entries declared in section pages
$sectionPages = ['news.php','royals.php','us.php','tv.php','buyline.php','mplus.php'];
foreach ($sectionPages as $sp) {
    $path = __DIR__ . '/' . $sp;
    if (!file_exists($path)) continue;
    $txt = file_get_contents($path);
    // Find short array item blocks like [ 'title' => '...', 'link' => '...', ... ]
    if (preg_match_all('/\[(?:[^\[\]]|(?R))*\]/s', $txt, $blocks)) {
        foreach ($blocks[0] as $blk) {
            // only consider blocks that contain a link to an articles/ path
            if (!preg_match("/['\"]?link['\"]?\s*=>\s*['\"]([^'\"]+)['\"]/i", $blk, $m)) continue;
            $link = trim($m[1]);
            if (stripos($link, 'podcast') !== false || stripos($link, 'podcasts') !== false) continue;

            // extract other fields if present
            $title = null; $excerpt = null; $image = null; $category = null; $comments = null; $shares = null;
            if (preg_match("/['\"]?title['\"]?\s*=>\s*['\"]([^'\"]+)['\"]/i", $blk, $mt)) $title = trim($mt[1]);
            if (!$title && preg_match("/['\"]?title['\"]?\s*=>\s*([^,\]]+)/i", $blk, $mt2)) $title = trim(trim($mt2[1], " \t\n\r\'\""));
            if (preg_match("/['\"]?excerpt['\"]?\s*=>\s*['\"]([^'\"]+)['\"]/i", $blk, $me)) $excerpt = trim($me[1]);
            if (preg_match("/['\"]?image['\"]?\s*=>\s*['\"]([^'\"]+)['\"]/i", $blk, $mi)) $image = trim($mi[1]);
            if (preg_match("/['\"]?category['\"]?\s*=>\s*['\"]([^'\"]+)['\"]/i", $blk, $mc)) $category = trim($mc[1]);
            if (preg_match("/['\"]?comments['\"]?\s*=>\s*(\d+)/i", $blk, $mco)) $comments = intval($mco[1]);
            if (preg_match("/['\"]?shares['\"]?\s*=>\s*(\d+)/i", $blk, $msh)) $shares = intval($msh[1]);

            // Build item
            $item = [];
            if ($title) $item['title'] = $title;
            if ($excerpt) $item['excerpt'] = $excerpt;
            if ($image) $item['image'] = $image;
            if ($category) $item['category'] = $category;
            if ($comments !== null) $item['comments'] = $comments; else $item['comments'] = 0;
            if ($shares !== null) $item['shares'] = $shares; else $item['shares'] = 0;
            $item['link'] = $link;

            // dedupe against existing extra_feed (by link or title)
            $exists = false;
            foreach ($extra_feed as $ex) {
                if (isset($ex['link']) && isset($item['link']) && strtolower($ex['link']) === strtolower($item['link'])) { $exists = true; break; }
                if (isset($ex['title']) && isset($item['title']) && strtolower(strip_tags($ex['title'])) === strtolower(strip_tags($item['title']))) { $exists = true; break; }
            }
            if (!$exists) $extra_feed[] = $item;
        }
    }
}

// Merge extra feed items into main feed without duplicates (use link or stripped title as key)
$seen = [];
$merged = [];
foreach ($main_feed as $it) {
    $key = isset($it['link']) ? $it['link'] : strip_tags($it['title']);
    $lk = strtolower($key);
    $seen[$lk] = true;
    $merged[] = $it;
}
foreach ($extra_feed as $it) {
    $key = isset($it['link']) ? $it['link'] : strip_tags($it['title']);
    $lk = strtolower($key);
    if (!isset($seen[$lk])) { $seen[$lk] = true; $merged[] = $it; }
}
$main_feed = $merged;
/* Also merge extra_feed into the category strip when the article's category
    matches one of the index category filters. */
$cat_filters = ['Sports','Showbiz','Lifestyle','Health','Science','Money','Travel'];

// Build seen map for existing category strip items (dedupe by link or title)
$cat_seen = [];
foreach ($category_strip as $c) {
    $k = isset($c['link']) ? $c['link'] : strip_tags($c['title']);
    $cat_seen[strtolower($k)] = true;
}

foreach ($extra_feed as $it) {
    if (!isset($it['category'])) continue;
    if (!in_array($it['category'], $cat_filters)) continue;
    $k = isset($it['link']) ? $it['link'] : strip_tags($it['title']);
    $lk = strtolower($k);
    if (!isset($cat_seen[$lk])) { $category_strip[] = $it; $cat_seen[$lk] = true; }
}

//uses shared header/footer
include __DIR__ . '/header.php';
?>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            <!-- Main column -->
            <div class="md:col-span-7">
                <!-- Hero Section -->
                <section class="mb-8">
                    <img src="assets/news_article_pics/news1coffeeimg1.png" alt="Hero" class="w-full rounded-lg shadow object-cover" style="height:320px;" />
                    <div class="mt-4">
                        <h1 class="text-2xl font-semibold"><a href="articles/article.php" class="text-blue-800 hover:underline">Best bean-to-cup coffee machine: The tried and tested automatics I recommend for a fuss-free brew, even if you're a complete beginner</a></h1>
                        <p class="text-gray-600 mt-2">If you're a coffee lover that values convenience, quality and time, these are the tested bean-to-cup picks that I recommend to everyone. From espresso...</p>
                    </div>
                </section>

                <!-- Main sections kept below the hero -->
                <section class="mb-8">
                    <div class="bg-blue-700 text-white px-4 py-2 rounded-t-lg inline-block">PERSONAL FEED</div>
                    <div class="bg-white p-4 rounded-b-lg shadow">
                        <div class="relative">
                            <button aria-label="Scroll personal left" class="absolute left-2 top-1/2 -translate-y-1/2 z-20 bg-white rounded-full p-2 shadow" onclick="scrollFeed('personal-feed-row','left')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-700" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.293 15.707a1 1 0 01-1.414 0L5.172 10l5.707-5.707a1 1 0 011.414 1.414L8.414 10l3.879 3.879a1 1 0 010 1.414z" clip-rule="evenodd"/></svg>
                            </button>
                            <div id="personal-feed-row" class="flex gap-4 overflow-x-auto py-2 px-8">
                                                        <?php foreach($personal_feed as $item): ?>
                                    <?php $href = isset($item['link']) ? $item['link'] : 'articles/article.php'; ?>
                                    <article class="pf-card border p-3 bg-gray-50">
                                        <a href="<?php echo $href; ?>" class="block h-full">
                                            <img src="<?php echo $item['image']; ?>" alt="<?php echo htmlspecialchars($item['title']); ?>" class="pf-img rounded" />
                                            <h3 class="mt-2 font-bold text-sm"><?php echo $item['title']; ?></h3>
                                            <p class="text-xs text-gray-600 mt-1"><?php echo isset($item['excerpt']) ? $item['excerpt'] : strip_tags($item['title']); ?></p>
                                            <div class="mt-2 text-xs text-gray-500"><?php echo $item['comments']; ?> comments • <?php echo $item['shares']; ?> share</div>
                                        </a>
                                    </article>
                                <?php endforeach; ?>
                            </div>
                            <button aria-label="Scroll personal right" class="absolute right-2 top-1/2 -translate-y-1/2 z-20 bg-white rounded-full p-2 shadow flex items-center justify-center" onclick="scrollFeed('personal-feed-row','right')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-700 block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg>
                            </button>
                        </div>
                    </div>
                </section>

                <section class="mb-8">
                    <div class="flex items-center">
                        <div class="inline-flex items-center relative">
                            <div class="bg-blue-700 text-white px-4 py-2 rounded-t-lg inline-block">MAIN FEED</div>
                            <button id="mainFiltersToggle" aria-expanded="false" aria-controls="mainFiltersStrip" class="ml-2 h-9 w-9 flex items-center justify-center text-sm rounded bg-white border">
                                <svg id="mainToggleIcon" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 transform rotate-0 transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 4a1 1 0 011.707-.707l6 6a1 1 0 010 1.414l-6 6A1 1 0 016 16.586L11.586 11 6 5.414A1 1 0 016 4z" clip-rule="evenodd"/></svg>
                            </button>
                            <div id="mainFiltersStrip" class="panel-slide bg-white border rounded h-9 flex items-center gap-2 px-2 overflow-x-auto">
                                <!-- Main feed filter buttons-->
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-b-lg shadow">
                        <div class="relative">
                            <button aria-label="Scroll main left" class="absolute left-2 top-1/2 -translate-y-1/2 z-20 bg-white rounded-full p-2 shadow" onclick="scrollFeed('main-feed-row','left')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-700" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.293 15.707a1 1 0 01-1.414 0L5.172 10l5.707-5.707a1 1 0 011.414 1.414L8.414 10l3.879 3.879a1 1 0 010 1.414z" clip-rule="evenodd"/></svg>
                            </button>
                            <div id="main-feed-row" class="flex gap-6 overflow-x-auto py-2 px-8">
                                <!-- Main feed cards rendered by JS -->
                            </div>
                            <button aria-label="Scroll main right" class="absolute right-2 top-1/2 -translate-y-1/2 z-20 bg-white rounded-full p-2 shadow flex items-center justify-center" onclick="scrollFeed('main-feed-row','right')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-700 block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg>
                            </button>
                        </div>
                    </div>
                </section>

                <section class="mb-8">
                    <div class="flex items-center">
                        <div class="inline-flex items-center relative">
                            <div class="bg-blue-700 text-white px-4 py-2 rounded-t-lg inline-block">CATEGORY STRIP</div>
                            <button id="catFiltersToggle" aria-expanded="false" aria-controls="catFiltersPanel" class="ml-2 h-9 w-9 flex items-center justify-center text-sm rounded bg-white border">
                                <svg id="catToggleIcon" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 transform rotate-0 transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 4a1 1 0 011.707-.707l6 6a1 1 0 010 1.414l-6 6A1 1 0 016 16.586L11.586 11 6 5.414A1 1 0 016 4z" clip-rule="evenodd"/></svg>
                            </button>
                            <div id="catFiltersPanel" class="panel-slide bg-white border rounded h-9 flex gap-2 items-center overflow-x-auto px-2">
                                <!-- horizontal category filter buttons -->
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-b-lg shadow">
                        <div class="relative">
                            <button aria-label="Scroll category left" class="absolute left-2 top-1/2 -translate-y-1/2 z-20 bg-white rounded-full p-2 shadow" onclick="scrollFeed('category-strip-row','left')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-700" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.293 15.707a1 1 0 01-1.414 0L5.172 10l5.707-5.707a1 1 0 011.414 1.414L8.414 10l3.879 3.879a1 1 0 010 1.414z" clip-rule="evenodd"/></svg>
                            </button>
                            <div id="category-strip-row" class="flex gap-4 overflow-x-auto py-2 px-8">
                                <!-- Category cards rendered by JS -->
                            </div>
                            <button aria-label="Scroll category right" class="absolute right-2 top-1/2 -translate-y-1/2 z-20 bg-white rounded-full p-2 shadow flex items-center justify-center" onclick="scrollFeed('category-strip-row','right')">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-700 block" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg>
                            </button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Sidebar: Don't Miss Section-->
            <aside class="md:col-span-3">
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="bg-blue-600 text-white px-4 py-2 font-semibold">Don't Miss</div>
                    <div class="p-3">
                        <?php foreach(array_slice($main_feed,0,9) as $item): ?>
                            <?php $sHref = isset($item['link']) ? $item['link'] : 'articles/article.php'; ?>
                            <div class="flex gap-3 py-3 border-b last:border-b-0">
                                <img src="<?php echo $item['image']; ?>" alt="<?php echo htmlspecialchars($item['title']); ?>" class="w-20 h-14 object-cover rounded" />
                                <div>
                                    <div class="text-xs text-red-600 font-semibold">EXCLUSIVE</div>
                                    <a href="<?php echo $sHref; ?>" class="text-sm font-semibold text-blue-700 hover:underline"><?php echo $item['title']; ?></a>
                                    <div class="text-xs text-gray-500 mt-1"><?php echo $item['comments']; ?> comments</div>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                </div>
            </aside>

            <!-- Narrow ad column -->
            <div class="hidden md:block md:col-span-2">
                <div class="sticky top-24">
                    <div class="text-xs text-gray-500 mb-2">ADVERTISEMENT</div>
                    <div class="bg-white p-2 rounded shadow flex justify-center">
                        <img src="assets/ads.png" alt="Ad" class="w-28 h-auto object-contain" />
                    </div>
                </div>
            </div>
        </div>
    </main>
<?php include __DIR__ . '/footer.php'; ?>
<style>
/* Slide + fade animation helpers for filter strips */
.anim-hidden {
    max-height: 0;
    opacity: 0;
    transform: translateY(-6px);
    transition: max-height .28s ease, opacity .28s ease, transform .28s ease;
    overflow: hidden;
}
.anim-open {
    max-height: 600px;
    opacity: 1;
    transform: translateY(0);
    transition: max-height .35s ease, opacity .35s ease, transform .35s ease;
}

/* Panels that expand to the right from the chevron and "cramp" back into it when closed.
   Implementation notes:
   - Closed state: scaleX(0) at the left edge (chevron) so the panel visually collapses into the chevron.
   - Open state: small rightward offset + scaleX(1) so the panel appears to slide to the right when opened.
   - transform-origin is set to left so scaling always collapses toward the chevron and never slides through the heading.
*/
.panel-slide {
    position: absolute;
    left: 100%;
    right: auto;
    top: 50%;
    transform-origin: left center;
    /* closed visual: collapsed toward the chevron */
    transform: translateY(-50%) translateX(0) scaleX(0);
    opacity: 0;
    transition: transform .26s cubic-bezier(.2,.9,.2,1), opacity .2s ease;
    z-index: 30;
    white-space: nowrap;
    pointer-events: none; /* avoid tabbing into hidden panel */
}
.panel-slide.open {
    /* open visual: slightly translated to the right and fully expanded */
    transform: translateY(-50%) translateX(10px) scaleX(1);
    opacity: 1;
    pointer-events: auto;
}

/* Hide native scrollbar arrows for the horizontal filter strips while keeping scrolling usable
    Targets the main filter strip, category filter panel, and the category strip row. */
#mainFiltersStrip,
#catFiltersPanel,
#category-strip-row,
#personal-feed-row,
#main-feed-row {
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
}

/* WebKit browsers: remove scrollbar entirely (no arrows). */
#mainFiltersStrip::-webkit-scrollbar,
#catFiltersPanel::-webkit-scrollbar,
#category-strip-row::-webkit-scrollbar,
#personal-feed-row::-webkit-scrollbar,
#main-feed-row::-webkit-scrollbar {
    display: none; /* Safari/Chrome */
    width: 0;
    height: 0;
}

/* Also hide any scrollbar buttons specifically (extra safety for some engines) */
#mainFiltersStrip::-webkit-scrollbar-button,
#catFiltersPanel::-webkit-scrollbar-button,
#category-strip-row::-webkit-scrollbar-button,
#personal-feed-row::-webkit-scrollbar-button,
#main-feed-row::-webkit-scrollbar-button {
    display: none;
    width: 0;
    height: 0;
}
</style>
<script>
// Embed PHP arrays as JSON for client-side filtering
const MAIN_FEED = <?php echo json_encode($main_feed, JSON_HEX_TAG); ?>;
const CAT_STRIP = <?php echo json_encode($category_strip, JSON_HEX_TAG); ?>;

const MAIN_FILTERS = ['All','Latest headlines','Australia','Scotland','Books','Columnists'];
const CAT_FILTERS = ['All','Sports','Showbiz','Lifestyle','Health','Science','Money','Travel'];

function renderMainFeed(filter) {
    const container = document.getElementById('main-feed-grid');
    // render into the horizontal row
    const row = document.getElementById('main-feed-row');
    row.innerHTML = '';
    const items = MAIN_FEED.filter(i => !filter || filter === 'All' ? true : i.category === filter);
    if (items.length === 0) {
        row.innerHTML = '<div class="text-center text-gray-500">No items for this filter.</div>';
        return;
    }
    items.forEach(post => {
        const art = document.createElement('article');
        art.className = 'pf-card bg-gray-50 rounded overflow-hidden shadow-sm';
        const href = post.link ? post.link : 'articles/article.php';
        art.innerHTML = `
            <a href="${href}" class="block h-full">
                <img src="${post.image}" alt="${escapeHtml(post.title)}" class="pf-img" />
                <div class="p-3">
                    <h3 class="mt-2 font-bold text-sm">${escapeHtml(post.title)}</h3>
                    <p class="text-xs text-gray-600 mt-1">${escapeHtml(post.excerpt || post.title || '')}</p>
                    <div class="mt-3 text-xs text-gray-500">${post.comments} comments • ${post.shares} shares</div>
                </div>
            </a>`;
        row.appendChild(art);
    });
}

function renderCategoryStrip(filter) {
    const row = document.getElementById('category-strip-row');
    row.innerHTML = '';
    const items = CAT_STRIP.filter(i => !filter || filter === 'All' ? true : i.category === filter);
    if (items.length === 0) {
        row.innerHTML = '<div class="text-gray-500">No items for this filter.</div>';
        return;
    }
    items.forEach(cat => {
        const card = document.createElement('div');
        card.className = 'pf-card bg-gray-50 rounded shadow-sm p-3';
        const href = cat.link ? cat.link : 'articles/article.php';
        // Wrap card contents in an anchor when a link is available so the whole card is clickable
        card.innerHTML = `
            <a href="${href}" class="block h-full">
                <img src="${cat.image}" alt="${escapeHtml(cat.title)}" class="pf-img rounded" />
                <h4 class="mt-2 font-bold text-sm">${escapeHtml(cat.title)}</h4>
                <p class="text-xs text-gray-600 mt-1">${escapeHtml(cat.excerpt || cat.title || '')}</p>
                <div class="text-xs text-gray-500 mt-1">${cat.comments} comments • ${cat.shares} shares</div>
            </a>`;
        row.appendChild(card);
    });
}

function escapeHtml(str) {
    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

function renderMainFilters() {
    const container = document.getElementById('mainFiltersStrip');
    if(!container) return;
    MAIN_FILTERS.forEach(f => {
        const btn = document.createElement('button');
        btn.className = 'text-sm px-3 h-9 flex items-center rounded bg-white text-gray-800 whitespace-nowrap';
        btn.textContent = f;
        btn.dataset.filter = f;
        btn.addEventListener('click', () => {
            document.querySelectorAll('#mainFiltersStrip button').forEach(b => {
                b.classList.remove('bg-blue-600','text-white');
                b.classList.add('bg-white','text-gray-800');
            });
            btn.classList.remove('bg-white','text-gray-800');
            btn.classList.add('bg-blue-600','text-white');
            renderMainFeed(f);
        });
        container.appendChild(btn);
    });
    const first = container.querySelector('button[data-filter="All"]');
    if (first) first.click();
}

function renderCatFilters() {
    const panel = document.getElementById('catFiltersPanel');
    if(!panel) return;
    CAT_FILTERS.forEach(f => {
        const btn = document.createElement('button');
        btn.className = 'text-sm px-3 h-9 flex items-center rounded bg-white text-gray-800 whitespace-nowrap';
        btn.textContent = f;
        btn.dataset.filter = f;
        btn.addEventListener('click', () => {
            document.querySelectorAll('#catFiltersPanel button').forEach(b => {
                b.classList.remove('bg-blue-600','text-white');
                b.classList.add('bg-white','text-gray-800');
            });
            btn.classList.remove('bg-white','text-gray-800');
            btn.classList.add('bg-blue-600','text-white');
            renderCategoryStrip(f);
        });
        panel.appendChild(btn);
    });
    const first = panel.querySelector('button[data-filter="All"]');
    if (first) first.click();
}

document.addEventListener('DOMContentLoaded', function(){
    renderMainFilters();
    renderCatFilters();
    // toggles
    const mainToggle = document.getElementById('mainFiltersToggle');
    const mainStrip = document.getElementById('mainFiltersStrip');
    const mainIcon = document.getElementById('mainToggleIcon');
    if (mainToggle && mainStrip) {
        mainToggle.addEventListener('click', () => {
            // toggle horizontal slide panel
            const isOpen = mainStrip.classList.toggle('open');
            mainToggle.setAttribute('aria-expanded', String(isOpen));
            if (mainIcon) mainIcon.classList.toggle('rotate-180', isOpen);
        });
    }
    const catToggle = document.getElementById('catFiltersToggle');
    const catPanel = document.getElementById('catFiltersPanel');
    const catIcon = document.getElementById('catToggleIcon');
    if (catToggle && catPanel) {
        catToggle.addEventListener('click', () => {
            const isOpen = catPanel.classList.toggle('open');
            catToggle.setAttribute('aria-expanded', String(isOpen));
            if (catIcon) catIcon.classList.toggle('rotate-180', isOpen);
        });
    }

    // expose scroll controls for carousels
    window.scrollFeed = function(id, dir) {
        const el = document.getElementById(id);
        if (!el) return;
        const amount = Math.round(el.clientWidth * 0.7) || 300;
        el.scrollBy({ left: dir === 'left' ? -amount : amount, behavior: 'smooth' });
    };
});
</script>
